---
import BaseLayout from "../../layouts/BaseLayout.astro";
import { getCollection } from "astro:content";

const articles = (await getCollection("articles"))
  .filter(a => !a.data.draft);

const tags = new Map<string, typeof articles>();
for (const a of articles) {
  for (const t of (a.data.tags ?? [])) {
    if (!tags.has(t)) tags.set(t, []);
    tags.get(t)!.push(a);
  }
}
const sortedTags = [...tags.entries()].sort((a,b) => a[0].localeCompare(b[0]));
---

<BaseLayout title="Article Tags">
  <h1>Tags</h1>
  <p>Browse articles by tag.</p>

  {sortedTags.map(([tag, items]) => (
    <section style="margin: 22px 0;">
      <h2 id={tag} style="margin-bottom:10px;">{tag}</h2>
      <div class="grid">
        {items
          .sort((a,b) => b.data.date.valueOf() - a.data.date.valueOf())
          .map(a => (
            <div class="card">
              <div class="pill">{a.data.date.toDateString()}</div>
              <h3 style="margin:10px 0 6px;">
                <a href={`/articles/${a.slug}`}>{a.data.title}</a>
              </h3>
              <p>{a.data.summary}</p>
            </div>
          ))}
      </div>
    </section>
  ))}
</BaseLayout>
